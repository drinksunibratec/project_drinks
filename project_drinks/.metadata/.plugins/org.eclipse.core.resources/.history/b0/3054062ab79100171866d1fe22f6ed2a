package managedbean;

import java.io.Serializable;

import javax.enterprise.context.SessionScoped;
import javax.faces.application.FacesMessage;
import javax.faces.bean.ManagedBean;
import javax.faces.context.FacesContext;

import basicas.Usuario;
import business.BasicBO;
import business.UsuarioBO;
import util.Mensagens;
import util.SessionContext;
import util.ValidacaoCampos;

@ManagedBean
@SessionScoped
public class UsuarioBean extends ManagedBeanGenerico<Usuario> implements Serializable{

	/**
	 * 
	 */
	private static final long serialVersionUID = -9135766805809990592L;
	private Usuario usuario;
	
	

	@Override
	public BasicBO<Usuario> getBoPadrao() {
		return UsuarioBO.getInstance();
	}

	@Override
	public void setBoPadrao(BasicBO<Usuario> boPadrao) {

	}

	@Override
	public void init() {
		super.init();
		usuario = new Usuario();
		usuario.setAtivo(true);

	}



	public Usuario getUsuario() {
		return usuario;
	}

	public void setUsuario(Usuario usuario) {
		this.usuario = usuario;
	}

	public String loadEdit(Usuario usuario){
		this.usuario = usuario;
		setEdit(true);
		return "OK";
	}

	@Override
	public void afterSave() {
		setBean(new Usuario());
		this.usuario = new Usuario();
		this.usuario.setAtivo(true);
	}

	@Override
	public void beforeSave() {
		setBean(usuario);
	}
	
	@Override
	public void beforeEdit() {
		setBean(usuario);
	}

	public Usuario getUsuarioLogado() {
		return (Usuario) SessionContext.getInstance().getUsuarioLogado();
	}

	public String doLogin() {
		
		ValidacaoCampos.validarLogin(usuario);
		
		Usuario usuarioLogado = UsuarioBO.getInstance().getUsuario(usuario);

		if (usuarioLogado == null) {
			ValidacaoCampos.addError(Mensagens.USUARIO_NAO_ENCONTRADO);
			return "";
		}

		SessionContext.getInstance().setAttribute("usuarioLogado", usuarioLogado);
		this.usuario = new Usuario();
		this.usuario.setAtivo(true);
		
		ValidacaoCampos.addInfo(Mensagens.USUARIO_LOGADO + ", " + usuarioLogado.getNome());
		
		return "/pages/index";

	}

	 public String doLogout() {
         SessionContext.getInstance().encerrarSessao();
         return "/pages/login.xhtml?faces-redirect=true";
      }




}
